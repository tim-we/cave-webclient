{"version":3,"sources":["webpack:///webpack/bootstrap 7d3a78e5c28ebc8a6e7a","webpack:///./ts/Controller.ts","webpack:///./ts/Model.ts","webpack:///./ts/Player.ts","webpack:///./ts/Vector.ts","webpack:///./ts/Map.ts","webpack:///./ts/View.ts","webpack:///./ts/Renderer.ts","webpack:///./ts/ShaderTools.ts","webpack:///./shader/map.vert","webpack:///./shader/map.frag"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;AC7DA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;;;;;;;AC5BA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;;;;;;;AC7DA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;;;;;;;;ACtCA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/BA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;;;;;;;;ACxBA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACZA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrBA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACnCA,0CAA0C,uCAAuC,wBAAwB,2BAA2B,+BAA+B,0BAA0B,yBAAyB,wFAAwF,KAAK,C;;;;;;ACAnT,0CAA0C,2BAA2B,yBAAyB,2BAA2B,KAAK,C","file":"./js/bundle/game.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7d3a78e5c28ebc8a6e7a","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Model_1 = require(\"./Model\");\r\nconst View = require(\"./View\");\r\nvar ws = null;\r\nvar model = null;\r\nfunction connect() {\r\n    ws = new WebSocket(\"ws://destroids.io:8000\");\r\n}\r\nwindow.addEventListener(\"load\", () => {\r\n    View.init();\r\n    test();\r\n});\r\nfunction mainloop() {\r\n    if (model) {\r\n        View.draw(model);\r\n        model.update();\r\n    }\r\n    window.requestAnimationFrame(mainloop);\r\n}\r\nfunction test() {\r\n    model = new Model_1.default({\r\n        type: 0,\r\n        n: 1,\r\n        i: 0,\r\n        t: -3,\r\n        names: [\"Bob\"]\r\n    });\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Controller.ts\n// module id = 0\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Player_1 = require(\"./Player\");\r\nconst Map_1 = require(\"./Map\");\r\nclass Model {\r\n    constructor(data) {\r\n        this.userInput = false;\r\n        let n = data.n;\r\n        console.assert(n > 0);\r\n        console.assert(data.names.length === n);\r\n        console.assert(data.t < 0);\r\n        this.Time = data.t;\r\n        this.TimeDelta = 0.0;\r\n        this.Players = new Array(n);\r\n        let z = 1.0;\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === data.i) {\r\n                this.Players[i] = new Player_1.default(data.names[i], 0);\r\n            }\r\n            else {\r\n                this.Players[i] = new Player_1.default(data.names[i], z);\r\n                z += 1.0;\r\n            }\r\n        }\r\n        this.Player = this.Players[data.i];\r\n        Object.freeze(this.Players);\r\n        this.Map = new Map_1.default();\r\n    }\r\n    setUserInput(pressed) {\r\n        this.userInput = pressed;\r\n    }\r\n    updateData(data) {\r\n        console.assert(data.t >= this.NextTime);\r\n        console.assert(data.ps.length === this.Players.length);\r\n        console.assert(data.as.length === this.Players.length);\r\n        this.TimeDelta = Math.max(32, data.t - this.Time);\r\n        this.NextTime = data.t;\r\n        this.Players.forEach((p, i) => {\r\n            let pos = data.ps[i];\r\n            p.updateData(pos.x, pos.y, data.as[i]);\r\n        });\r\n    }\r\n    update() {\r\n        if (this.TimeDelta <= 0.0) {\r\n            return;\r\n        }\r\n        let d = performance.now() - this.LastUpdate;\r\n        this.LastUpdate = performance.now();\r\n        if (this.Time > this.NextTime) {\r\n            this.Time = this.NextTime;\r\n        }\r\n        else {\r\n            this.Time += d;\r\n        }\r\n        let t = d / this.TimeDelta;\r\n        t = Math.max(Math.min(t, 2.0), 0.0);\r\n        this.Players.forEach(p => {\r\n            p.move(t);\r\n        });\r\n    }\r\n}\r\nexports.default = Model;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Model.ts\n// module id = 1\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Vector_1 = require(\"./Vector\");\r\nexports.TAILLENGTH = 42;\r\nclass Player {\r\n    constructor(name, zPos) {\r\n        this.Position = new Vector_1.default(0, 0);\r\n        this.Z = zPos;\r\n        this.PDelta = new Vector_1.default(0, 0);\r\n        this.PDeltaLength = 0;\r\n        this.Alive = true;\r\n        this.Tail = new Float32Array(exports.TAILLENGTH * 3);\r\n    }\r\n    updateData(px, py, alive) {\r\n        this.PDelta.diff2d(px, py);\r\n        this.PDeltaLength = this.PDelta.length();\r\n        this.Alive = alive;\r\n    }\r\n    move(a) {\r\n        Vector_1.default.axpy(a, this.PDelta, this.Position);\r\n        typedArrayUnshift(this.Tail, 3);\r\n        this.Tail[0] = this.Position.getX();\r\n        this.Tail[1] = this.Position.getY();\r\n        this.Tail[2] = this.Z;\r\n    }\r\n}\r\nexports.default = Player;\r\nfunction typedArrayUnshift(arr, k) {\r\n    let n = arr.length;\r\n    let p;\r\n    let i;\r\n    let j;\r\n    for (i = n - k; i > 0; i -= k) {\r\n        p = i - k;\r\n        for (j = 0; j < k; j++) {\r\n            arr[i + j] = arr[p + j];\r\n        }\r\n    }\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Player.ts\n// module id = 2\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Vector {\r\n    constructor(x = 0.0, y = 0.0) {\r\n        this.data = new Float64Array(2);\r\n        this.data[0] = x;\r\n        this.data[1] = y;\r\n    }\r\n    getX() {\r\n        return this.data[0];\r\n    }\r\n    getY() {\r\n        return this.data[1];\r\n    }\r\n    diff2d(x, y) {\r\n        this.data[0] = x - this.data[0];\r\n        this.data[1] = y - this.data[1];\r\n    }\r\n    length() {\r\n        return Math.sqrt(this.data[0] * this.data[0] + this.data[1] * this.data[1]);\r\n    }\r\n    static axpy(a, x, y) {\r\n        y.data[0] = a * x.data[0] + y.data[0];\r\n        y.data[1] = a * x.data[1] + y.data[1];\r\n    }\r\n    static distance2(a, b) {\r\n        let dx = a.data[0] - b.data[0];\r\n        let dy = a.data[1] - b.data[1];\r\n        return dx * dx + dy * dy;\r\n    }\r\n}\r\nexports.default = Vector;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Vector.ts\n// module id = 3\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst N = 42;\r\nconst SEGMENT_SIZE = 2 * 3 * 2;\r\nclass Map {\r\n    constructor() {\r\n        this.data = new Float32Array(SEGMENT_SIZE * N);\r\n        this.i = 0;\r\n    }\r\n    update(data) {\r\n        let n = data.length / 8;\r\n        let k, d, i, o, j;\r\n        for (k = 0; k < n; k++) {\r\n            d = this.i * SEGMENT_SIZE;\r\n            o = k * 8;\r\n            for (i = 0; i < 3; i++) {\r\n                this.data[d + 2 * i] = data[o + 2 * i];\r\n                this.data[d + 2 * i + 1] = data[o + 2 * i + 1];\r\n            }\r\n            for (i = 0; i < 3; i++) {\r\n            }\r\n        }\r\n    }\r\n}\r\nexports.default = Map;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Map.ts\n// module id = 4\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Renderer = require(\"./Renderer\");\r\nvar canvas;\r\nfunction init() {\r\n    canvas = document.getElementById(\"game\");\r\n    Renderer.init(canvas);\r\n}\r\nexports.init = init;\r\nfunction draw(model) {\r\n    Renderer.draw();\r\n}\r\nexports.draw = draw;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/View.ts\n// module id = 5\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst ShaderTools_1 = require(\"./ShaderTools\");\r\nvar gl = null;\r\nfunction init(canvas) {\r\n    try {\r\n        gl = canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\r\n    }\r\n    catch (e) {\r\n        console.warn(\"Error initializing webgl.\");\r\n    }\r\n    if (!gl) {\r\n        alert(\"Unable to initialize WebGL. Your browser may not support it.\");\r\n        return;\r\n    }\r\n    let p = ShaderTools_1.createProgramFromSource(gl, require(\"../shader/map.vert\"), require(\"../shader/map.frag\"));\r\n}\r\nexports.init = init;\r\nfunction draw() {\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n}\r\nexports.draw = draw;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/Renderer.ts\n// module id = 6\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction makeShader(gl, type, source) {\r\n    console.assert(type === gl.VERTEX_SHADER || type === gl.FRAGMENT_SHADER);\r\n    let shader = gl.createShader(type);\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n        console.error(\"Shader compile error \", gl.getShaderInfoLog(shader));\r\n        return null;\r\n    }\r\n    return shader;\r\n}\r\nexports.makeShader = makeShader;\r\nfunction createProgram(gl, shaders) {\r\n    console.assert(shaders.length > 0);\r\n    let program = gl.createProgram();\r\n    shaders.forEach(shader => gl.attachShader(program, shader));\r\n    gl.linkProgram(program);\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n        console.error(\"Unable to initialize the shader program.\", gl.getProgramInfoLog(program));\r\n        return null;\r\n    }\r\n    return program;\r\n}\r\nexports.createProgram = createProgram;\r\nfunction createProgramFromSource(gl, vssource, fssource) {\r\n    let shaders = [\r\n        makeShader(gl, gl.VERTEX_SHADER, vssource),\r\n        makeShader(gl, gl.FRAGMENT_SHADER, fssource)\r\n    ];\r\n    let shaderProgram = createProgram(gl, shaders);\r\n    gl.useProgram(shaderProgram);\r\n    return shaderProgram;\r\n}\r\nexports.createProgramFromSource = createProgramFromSource;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ts/ShaderTools.ts\n// module id = 7\n// module chunks = 0","module.exports = \"precision mediump float;\\r\\n\\r\\nattribute vec3 aVertexPosition;\\r\\n\\r\\nuniform float z;\\r\\n\\r\\nvarying vec4 color;\\r\\n\\r\\nuniform mat4 uMVMatrix;\\r\\nuniform mat4 uPMatrix;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition + vec3(0.0,0.0,z), 1.0);\\r\\n}\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./shader/map.vert\n// module id = 8\n// module chunks = 0","module.exports = \"precision mediump float;\\r\\n\\r\\nvarying vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = color;\\r\\n}\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./shader/map.frag\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}